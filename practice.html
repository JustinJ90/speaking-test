<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speaking Practice</title>
    <style>
        /* ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼ */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .pattern-selection { background: white; border-radius: 30px; padding: 60px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); max-width: 1000px; width: 100%; }
        .pattern-selection h1 { font-size: 3em; color: #667eea; text-align: center; margin-bottom: 20px; }
        .pattern-selection p { font-size: 1.3em; color: #666; text-align: center; margin-bottom: 40px; }
        .pattern-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .pattern-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 15px; cursor: pointer; transition: all 0.3s; text-align: center; }
        .pattern-card:hover { transform: translateY(-5px); box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4); }
        .pattern-card h3 { font-size: 1.5em; margin-bottom: 10px; }
        .pattern-card p { font-size: 1em; color: rgba(255, 255, 255, 0.9); margin: 0; }
        .slide-container { width: 90vw; max-width: 1200px; height: 80vh; background: white; border-radius: 30px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3); position: relative; overflow: hidden; display: none; }
        .slide-container.active { display: block; }
        .slide { width: 100%; height: 100%; display: none; flex-direction: column; justify-content: center; align-items: center; padding: 60px; position: absolute; top: 0; left: 0; animation: fadeIn 0.5s ease-in-out; }
        .slide.active { display: flex; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .slide-header { position: absolute; top: 30px; left: 50px; font-size: 1.2em; color: #667eea; font-weight: 600; }
        .slide-number { position: absolute; top: 30px; right: 50px; font-size: 1.2em; color: #999; }
        .emoji-icon { font-size: 12em; margin: 20px 0; margin-bottom: 30px; text-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); }
        .text-display { font-size: 2.5em; color: #666; margin: 40px 0; padding: 30px 60px; background: #f8f9fa; border-radius: 20px; border: 3px solid #dee2e6; word-break: keep-all; text-align: center;}
        .answer { font-size: 2.5em; color: #28a745; font-weight: 700; margin-top: 20px; padding: 25px 50px; background: #d4edda; border-radius: 20px; border: 4px solid #28a745; display: none; animation: slideDown 0.5s ease-out; max-width: 90%; text-align: center;}
        .answer.show { display: block; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
        .controls { position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; align-items: center; }
        .btn { padding: 18px 35px; font-size: 1.15em; border: none; border-radius: 50px; cursor: pointer; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; justify-content: center; gap: 8px; min-width: 140px; }
        .btn-show { background: #28a745; color: white; white-space: nowrap; }
        .btn-show:hover { background: #218838; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4); }
        .btn-next { background: #667eea; color: white; }
        .btn-next:hover { background: #764ba2; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-prev { background: #6c757d; color: white; }
        .btn-prev:hover { background: #5a6268; transform: translateY(-2px); }
        .btn-home { background: #dc3545; color: white; }
        .btn-home:hover { background: #c82333; transform: translateY(-2px); }
        .btn:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .progress-bar { position: absolute; top: 0; left: 0; height: 5px; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); transition: width 0.3s; }
        .instruction { position: absolute; bottom: 10px; font-size: 1em; color: #999; font-style: italic; }
    </style>
</head>
<body>
    <div class="pattern-selection" id="patternSelection">
        <img src="logo.jpg" alt="ìœ¤ì„ ìƒ ë¡œê³ " style="display: block; margin: 0 auto 20px; max-width: 200px;">
        
        <h1 id="bookTitle">ğŸ¤ Speaking Practice</h1>
        <p>ì—°ìŠµí•  íŒ¨í„´ì„ ì„ íƒí•˜ì„¸ìš”</p>
        <div class="pattern-grid" id="patternGrid"></div>
    </div>

    <div class="slide-container" id="slideContainer">
        <div class="progress-bar" id="progressBar"></div>
        <div id="slidesContent"></div>
        <div class="controls">
            <button class="btn btn-home" onclick="goHome()"><span>ğŸ </span><span>í™ˆ</span></button>
            <button class="btn btn-prev" onclick="prevSlide()"><span>â—€</span><span>ì´ì „</span></button>
            <button class="btn btn-show" onclick="showAnswer()" id="showBtn"><span>ì •ë‹µ ë³´ê¸°</span></button>
            <button class="btn btn-next" onclick="nextSlide()"><span>ë‹¤ìŒ</span><span>â–¶</span></button>
        </div>
    </div>

    <script src="data.js"></script>

    <script>
        const config = {
            emojiPatterns: [4, 5, 6, 10, 11, 12, 13, 17, 18],
            emojiMap: {
                'Korea': 'ğŸ‡°ğŸ‡·', 'France': 'ğŸ‡«ğŸ‡·', 'China': 'ğŸ‡¨ğŸ‡³', 'America': 'ğŸ‡ºğŸ‡¸', 'Italy': 'ğŸ‡®ğŸ‡¹', 'Canada': 'ğŸ‡¨ğŸ‡¦', 'Thailand': 'ğŸ‡¹ğŸ‡­', 'japan': 'ğŸ‡¯ğŸ‡µ', 'India': 'ğŸ‡®ğŸ‡³', 'Australia': 'ğŸ‡¦ğŸ‡º',
                'young': 'ğŸ‘¶', 'cute': 'ğŸ˜Š', 'strong': 'ğŸ’ª', 'smart': 'ğŸ§ ', 'baby': 'ğŸ‘¶', 'aunt': 'ğŸ‘©', 'kind': 'ğŸ˜‡', 'tall': 'ğŸ¦’', 'short': 'ğŸ§’',
                'picture': 'ğŸ–¼ï¸', 'owl': 'ğŸ¦‰', 'room': 'ğŸ ', 'book': 'ğŸ“–', 'kitchen': 'ğŸ³', 'bathroom': 'ğŸš½', 'tree': 'ğŸŒ²', 'Sarah': 'ğŸ‘§', 'Minho': 'ğŸ‘¦',
                'table': 'ğŸª‘', 'globe': 'ğŸŒ', 'cake': 'ğŸ‚', 'lion': 'ğŸ¦', 'soft': 'â˜ï¸', 'round': 'â­•', 'scary': 'ğŸ˜±', 'iguana': 'ğŸ¦',
                'sunny': 'â˜€ï¸', 'cloudy': 'â˜ï¸', 'rainy': 'ğŸŒ§ï¸', 'hot': 'ğŸ”¥', 'cold': 'â„ï¸', 'warm': 'ğŸŒ¡ï¸', 'cool': 'ğŸŒ¬ï¸', 'windy': 'ğŸ’¨', 'clear': 'ğŸŒ¤ï¸', 'snowing': 'ğŸŒ¨ï¸',
                'cup': 'ğŸ¥¤', 'paper': 'ğŸ“„', 'neck': 'ğŸ¦’', 'crayons': 'ğŸ–ï¸', 'question': 'â“', 'hair': 'ğŸ’‡', 'brother': 'ğŸ‘¦', 'sister': 'ğŸ‘§', 'piano': 'ğŸ¹', 'lesson': 'ğŸ“š', 'glue': 'ğŸ§´',
                'meat': 'ğŸ–', 'hamster': 'ğŸ¹', 'winter': 'â„ï¸', 'swimming': 'ğŸŠ', 'ice cream': 'ğŸ¦', 'English': 'ğŸ“š', 'cherries': 'ğŸ’', 'tennis': 'ğŸ¾', 'soccer': 'âš½', 'fish': 'ğŸŸ', 'eggs': 'ğŸ¥š',
                'baseball': 'âš¾', 'golf': 'â›³', 'cello': 'ğŸ»', 'guitar': 'ğŸ¸', 'volleyball': 'ğŸ', 'violin': 'ğŸ»', 'basketball': 'ğŸ€',
                'sweater': 'ğŸ§¥', 'hat': 'ğŸ©', 'mittens': 'ğŸ§¤', 'boots': 'ğŸ‘¢', 'jacket': 'ğŸ§¥', 'pants': 'ğŸ‘–', 'sunglasses': 'ğŸ•¶ï¸', 'shoes': 'ğŸ‘Ÿ', 'glasses': 'ğŸ‘“', 'socks': 'ğŸ§¦'
            }
        };

        // 2. ì£¼ì†Œì°½ì—ì„œ ì±… ì´ë¦„(?book=...)ì„ ì½ì–´ì˜µë‹ˆë‹¤.
        const urlParams = new URLSearchParams(window.location.search);
        const bookName = urlParams.get('book') || "Level A Book 1"; // ê¸°ë³¸ê°’

        // ì œëª©ì— ì±… ì´ë¦„ì„ í‘œì‹œí•´ ì¤ë‹ˆë‹¤.
        document.getElementById('bookTitle').innerText = `ğŸ¤ ${bookName}`;

        // 3. data.jsì—ì„œ í•´ë‹¹ ì±…ì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.
        let dbData = [];
        if (typeof bookData !== 'undefined') {
            dbData = bookData[bookName] || [];
        }

        if (dbData.length === 0) {
            alert("âš ï¸ ì„ íƒí•˜ì‹  êµì¬ì˜ ë°ì´í„°ê°€ ì•„ì§ ì¤€ë¹„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
        }

        let currentPattern = null;
        let currentSlide = 0;
        let slides = [];

        // íŒ¨í„´ ì´ë¦„ë„ data.jsì—ì„œ ë¶ˆëŸ¬ì˜¨ commonPatternNames ì‚¬ìš©
        const patternNames = (typeof commonPatternNames !== 'undefined') ? commonPatternNames : {};

        function init() { generatePatternCards(); }

        function generatePatternCards() {
            const grid = document.getElementById('patternGrid');
            // 1~20ë²ˆ íŒ¨í„´ ì¹´ë“œë¥¼ ë§Œë“­ë‹ˆë‹¤
            for (let i = 1; i <= 20; i++) {
                const card = document.createElement('div');
                card.className = 'pattern-card';
                
                // íŒ¨í„´ ì´ë¦„ì´ ìˆìœ¼ë©´ í‘œì‹œ, ì—†ìœ¼ë©´ 'Pattern X'ë¼ê³ ë§Œ í‘œì‹œ
                const pName = patternNames[i] || "";
                
                card.innerHTML = `<h3>Pattern ${i}</h3><p>${pName}</p>`;
                card.onclick = () => selectPattern(i);
                grid.appendChild(card);
            }
        }

        function selectPattern(patternNum) {
            currentPattern = patternNum;
            loadPatternData(patternNum);
        }

        function loadPatternData(patternNum) {
            // í˜„ì¬ ì„ íƒëœ ì±…ì˜ ë°ì´í„°(dbData)ì—ì„œ ê²€ìƒ‰
            const patternData = dbData.filter(row => {
                return row['Pattern #'] === patternNum && row['Section'] === 'Speaking II';
            });
            if (patternData.length === 0) { alert(`Pattern ${patternNum}ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.`); return; }
            generateSlides(patternNum, patternData);
        }

        function generateSlides(patternNum, data) {
            const container = document.getElementById('slidesContent');
            container.innerHTML = '';
            const useEmoji = config.emojiPatterns.includes(patternNum);
            container.appendChild(createTitleSlide(patternNum));
            data.forEach((item, index) => {
                container.appendChild(createQuestionSlide(patternNum, item, index, data.length, useEmoji));
            });
            container.appendChild(createEndSlide(patternNum));
            document.getElementById('patternSelection').style.display = 'none';
            document.getElementById('slideContainer').classList.add('active');
            slides = document.querySelectorAll('.slide');
            currentSlide = 0;
            updateSlide();
        }

        function createTitleSlide(patternNum) {
            const slide = document.createElement('div');
            slide.className = 'slide';
            const pName = patternNames[patternNum] || "";
            slide.innerHTML = `<div class="question" style="font-size: 4em; color: #667eea;">Pattern ${patternNum}: ${pName}</div><div style="font-size: 2em; color: #666; margin-top: 20px;">ë§í•˜ê¸° ì—°ìŠµ ìŠ¬ë¼ì´ë“œ</div><div style="margin-top: 60px; font-size: 1.5em; color: #999;">â–¶ ë‹¤ìŒì„ ëˆŒëŸ¬ ì‹œì‘í•˜ì„¸ìš”</div>`;
            return slide;
        }

        function createQuestionSlide(patternNum, item, index, total, useEmoji) {
            const slide = document.createElement('div');
            slide.className = 'slide';
            const englishQuestion = item['English/Answer'] || item['Korean/Question'];
            const koreanHint = item['Korean/Question'];
            const pName = patternNames[patternNum] || "";
            
            let visualContent = '';
            if (useEmoji) {
                const emoji = extractEmoji(englishQuestion, koreanHint);
                if (emoji) visualContent = `<div class="emoji-icon">${emoji}</div>`;
                else visualContent = `<div class="text-display">${koreanHint}</div>`;
            } else {
                visualContent = `<div class="text-display">${koreanHint}</div>`;
            }
            slide.innerHTML = `<div class="slide-header">Pattern ${patternNum}: ${pName}</div><div class="slide-number">${index + 1} / ${total}</div>${visualContent}<div class="answer" id="answer-${index}">${englishQuestion}</div><div class="instruction">í•™ìƒì´ ëŒ€ë‹µí•œ í›„ "ì •ë‹µ ë³´ê¸°"ë¥¼ í´ë¦­í•˜ì„¸ìš”</div>`;
            return slide;
        }

        function createEndSlide(patternNum) {
            const slide = document.createElement('div');
            slide.className = 'slide';
            slide.innerHTML = `<div class="question" style="font-size: 4em; color: #28a745;">ìˆ˜ê³ í–ˆìŠµë‹ˆë‹¤! ğŸ‰</div><div style="font-size: 2em; color: #666; margin-top: 40px;">Pattern ${patternNum} ì—°ìŠµ ì™„ë£Œ</div>`;
            return slide;
        }

        function extractEmoji(english, korean) {
            const text = (english + ' ' + korean).toLowerCase();
            for (const [keyword, emoji] of Object.entries(config.emojiMap)) {
                if (text.includes(keyword.toLowerCase())) return emoji;
            }
            return null;
        }

        function updateSlide() {
            slides.forEach((slide, index) => {
                slide.classList.remove('active');
                if (index === currentSlide) slide.classList.add('active');
            });
            const progress = (currentSlide / (slides.length - 1)) * 100;
            document.getElementById('progressBar').style.width = progress + '%';
            const showBtn = document.getElementById('showBtn');
            if (currentSlide > 0 && currentSlide < slides.length - 1) {
                showBtn.style.display = 'inline-flex';
                const answerEl = document.getElementById(`answer-${currentSlide - 1}`);
                if (answerEl) answerEl.classList.remove('show');
            } else {
                showBtn.style.display = 'none';
            }
        }

        function showAnswer() {
            const answerEl = document.getElementById(`answer-${currentSlide - 1}`);
            if (answerEl) answerEl.classList.add('show');
        }

        function nextSlide() { if (currentSlide < slides.length - 1) { currentSlide++; updateSlide(); } }
        function prevSlide() { if (currentSlide > 0) { currentSlide--; updateSlide(); } }
        
        // [ìˆ˜ì •ë¨] í™ˆ ë²„íŠ¼ ëˆ„ë¥´ë©´, 'ì±… ëª©ë¡'(index.html)ì´ ì•„ë‹ˆë¼ 'íŒ¨í„´ ëª©ë¡'(ì´ í˜ì´ì§€ ì²˜ìŒ)ìœ¼ë¡œ ëŒì•„ê°
        // ë§Œì•½ ì•„ì˜ˆ 'ì±… ì„ íƒ í™”ë©´'ìœ¼ë¡œ ê°€ê³  ì‹¶ë‹¤ë©´ window.location.href = 'index.html' ë¡œ ë°”ê¾¸ì„¸ìš”.
        function goHome() { 
            document.getElementById('slideContainer').classList.remove('active'); 
            document.getElementById('patternSelection').style.display = 'block'; 
            currentSlide = 0; 
        }

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('slideContainer').classList.contains('active')) {
                if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
                else if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
                else if (e.key === 'Enter') { e.preventDefault(); showAnswer(); }
                else if (e.key === 'Escape') { goHome(); }
            }
        });

        window.onload = init;
    </script>
</body>
</html>